# OpenClaw 模型代碼檢查報告（2026-02-12）

## 1. 設定檔 `~/.openclaw/openclaw.json`

### 結構檢查：通過

- **agents.defaults.models**：為 object，每個 key 對應的 value 皆為 object（無字串等非法型別）。
- **primary / fallbacks**：`kimi/kimi-k2.5`、`kimi/kimi-k2-turbo-preview`、`anthropic/claude-sonnet-4-5-20250929`、`anthropic/claude-haiku-4-5-20251001` 皆在 `agents.defaults.models` 的 allowlist 中。
- **models.providers**：kimi / anthropic / google / ollama 的 `models` 皆為 array，且每個 model 皆有 `id`。

### 注意事項（已處理）

- **anthropic**：已於 2026-02-12 在 `openclaw.json` 的 `models.providers.anthropic` 中加上 `apiKey`（自 .env 同步），Gateway 常駐時 Claude 可正常使用。
- **google** 使用 `api: "openai-completions"` + `baseUrl` 含 `/openai`，目前 `openclaw doctor` 未報錯，可維持現狀。
- **安全**：`openclaw.json` 已設為 `chmod 600`；Gateway 綁定 `lan` 時請確保 token 強度足夠。

---

## 2. 專案內與「模型」相關的程式碼

### server（任務面版後端）

- **executor-agents.ts**
  - 執行 OpenClaw 的方式：`openclaw agent --agent main --local --message "..."`。
  - **未**傳入任何 model ID；模型完全由 `~/.openclaw/openclaw.json` 的 `agents.defaults.model.primary` / `fallbacks` 決定，專案與 openclaw 模型設定一致，無硬編碼模型 ID 衝突問題。
  - 零 Token 維護任務中，Ollama 健康檢查使用的模型為 `qwen3:8b`、`deepseek-r1:8b`，與你目前 openclaw.json 的 ollama 模型 ID 一致。

### 其他

- **openclawSupabase.ts**：僅處理任務/審核/自動化資料，不讀寫 OpenClaw 的 primary/fallback 或 model allowlist。
- 前端與 API 未發現向 OpenClaw Gateway 傳遞 model 參數的邏輯。

---

## 3. 文件與設定一致性

- **docs/OPENCLAW-MODELS-REFERENCE.md** 中 Kimi 說明為「部分環境也用 `kimi/kimi-k2.5`」，與目前 `primary: "kimi/kimi-k2.5"` 一致。
- **docs/模型不回話-排查步驟.md** 中的 404 / Gemini / primary 檢查步驟仍適用於目前設定。

---

## 4. 總結

| 項目 | 狀態 |
|------|------|
| openclaw.json 模型結構 | 正常 |
| primary/fallbacks 與 allowlist | 一致 |
| 專案是否硬編碼模型 ID | 否，無衝突 |
| Ollama 健康檢查模型 ID | 與設定一致 |
| anthropic 依賴環境變數 | 需確保 Gateway 能讀到 ANTHROPIC_API_KEY |

**結論**：目前 OpenClaw 模型相關設定與專案程式碼無結構錯誤或明顯不一致；唯一建議是補強 Anthropic 的 key 來源（.env 或 openclaw.json），避免 LaunchAgent 環境下 Claude 無 key 可用。
